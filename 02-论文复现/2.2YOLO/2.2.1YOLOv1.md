# ğŸ“–YOLOV1é€Ÿè§ˆ

 ## 1ï¸âƒ£çŸ¥è¯†å‰å¯¼

### RCNNï¼ˆä¸¤é˜¶æ®µï¼‰

#### 1.ç”Ÿæˆå€™é€‰åŒºåŸŸï¼ˆRegion Proposalsï¼‰ 

**Selective Search** æ–¹æ³•ï¼š

- å…ˆå¯¹è¾“å…¥å›¾åƒè¿›è¡Œ **å¤šå°ºåº¦åˆ†å‰²**ï¼Œç”Ÿæˆä¸€ç³»åˆ—è¶…åƒç´ ï¼ˆSuperpixelsï¼‰ã€‚
- é€æ­¥åˆå¹¶ç›¸ä¼¼çš„åŒºåŸŸï¼Œå½¢æˆä¸åŒå¤§å°çš„å€™é€‰æ¡†ï¼ˆRegion Proposalsï¼‰ã€‚
- æœ€ç»ˆç”Ÿæˆ **å¤§çº¦ 2000 ä¸ªå€™é€‰åŒºåŸŸ**ï¼Œè¿™äº›åŒºåŸŸè¢«è®¤ä¸ºå¯èƒ½åŒ…å«ç›®æ ‡ã€‚

#### 2.ç‰¹å¾æå–ï¼ˆFeature Extractionï¼‰

**ä½¿ç”¨ AlexNetå¯¹æ¯ä¸ªå€™é€‰åŒºåŸŸè¿›è¡Œç‰¹å¾æå–**ï¼š

- **å°†æ¯ä¸ªå€™é€‰åŒºåŸŸç¼©æ”¾åˆ°å›ºå®šå¤§å°**ï¼ˆå¦‚ 224Ã—224ï¼‰ã€‚

- **é€å…¥ CNN æå–ç‰¹å¾**ï¼ˆé€šå¸¸ä½¿ç”¨é¢„è®­ç»ƒçš„ CNNï¼Œå¦‚ AlexNetã€VGG16ï¼‰ã€‚

- **å¾—åˆ°ç‰¹å¾å‘é‡**ï¼Œå¹¶å­˜å…¥ SVM è¿›è¡Œåˆ†ç±»

#### 3. åˆ†ç±»ä¸å›å½’

RCNN é‡‡ç”¨ **ä¸¤ä¸ªç‹¬ç«‹çš„æ¨¡å‹** æ¥è¿›è¡Œç›®æ ‡åˆ†ç±»å’Œè¾¹ç•Œæ¡†ä¿®æ­£ï¼š

- ç›®æ ‡åˆ†ç±»ï¼ˆClassificationï¼‰
  - é‡‡ç”¨ **SVMï¼ˆæ”¯æŒå‘é‡æœºï¼‰** å¯¹ CNN æå–çš„ç‰¹å¾è¿›è¡Œåˆ†ç±»ï¼Œåˆ¤æ–­è¯¥å€™é€‰åŒºåŸŸå±äºå“ªä¸ªç±»åˆ«ï¼ˆå¦‚ "cat", "dog", "car"ï¼‰ã€‚
- è¾¹ç•Œæ¡†å›å½’ï¼ˆBounding Box Regressionï¼‰
  - ç”±äº Selective Search ç”Ÿæˆçš„å€™é€‰æ¡†å¯èƒ½ä¸å¤Ÿå‡†ç¡®ï¼ŒRCNN è®­ç»ƒäº†ä¸€ä¸ª **çº¿æ€§å›å½’æ¨¡å‹** æ¥è°ƒæ•´è¾¹ç•Œæ¡†çš„ä½ç½®ï¼Œä½¿å…¶æ›´è´´åˆç›®æ ‡ã€‚

#### 4. è¿›è¡Œç›®æ ‡æ£€æµ‹

- ç”±äº å¤šä¸ªå€™é€‰åŒºåŸŸå¯èƒ½è¦†ç›–åŒä¸€ä¸ªç›®æ ‡ï¼Œä¼šå¯¼è‡´å¤šä¸ªæ£€æµ‹æ¡†ã€‚ä¸ºäº†å¾—åˆ°æœ€ç»ˆçš„æ£€æµ‹ç»“æœï¼ŒRCNN é‡‡ç”¨ï¼š
  - éæå¤§å€¼æŠ‘åˆ¶ï¼ˆNMS, Non-Maximum Suppressionï¼‰ï¼š
    - æŒ‰ç½®ä¿¡åº¦æ’åºï¼Œåˆ é™¤ä¸é«˜ç½®ä¿¡åº¦ç›®æ ‡é‡å åº¦é«˜ï¼ˆIOU > é˜ˆå€¼ï¼‰çš„æ¡†ï¼Œä¿ç•™æœ€ä¼˜æ¡†ã€‚
- æœ€ç»ˆè¾“å‡ºæ£€æµ‹ç»“æœï¼ŒåŒ…æ‹¬ï¼š
  - **ç±»åˆ«æ ‡ç­¾**
  - **ç›®æ ‡ä½ç½®ï¼ˆBounding Box: x, y, w, hï¼‰**

![](./img/4a5ab37723b7f05fd967bb1132ee9e30.png)

## 2ï¸âƒ£YOLOv1ï¼ˆå•é˜¶æ®µï¼‰

### æ ¸å¿ƒæ€æƒ³ï¼š

1ã€**æŠŠç›®æ ‡æ£€æµ‹è§†ä¸ºä¸€ä¸ªå•ä¸€çš„å›å½’é—®é¢˜**ï¼Œå³ä»è¾“å…¥å›¾åƒç›´æ¥é¢„æµ‹ç›®æ ‡çš„ç±»åˆ«å’Œä½ç½®ï¼Œè€Œä¸æ˜¯åƒ RCNN é‚£æ ·å…ˆç”Ÿæˆå€™é€‰åŒºåŸŸå†åˆ†ç±»ã€‚

2ã€**æ•´å¼ å›¾åƒåªé€šè¿‡ä¸€æ¬¡ CNN å‰å‘ä¼ æ’­**ï¼Œç›´æ¥å¾—åˆ°æ‰€æœ‰ç›®æ ‡çš„ç±»åˆ«å’Œè¾¹ç•Œæ¡†ï¼Œå› æ­¤é€Ÿåº¦æå¿«ï¼Œé€‚ç”¨äº**å®æ—¶æ£€æµ‹**ã€‚ï¼ˆç«¯åˆ°ç«¯ï¼‰

![](./img/v2-41907e6e221b81045344bb6ab55e92cf_r.jpg)

### ç®—æ³•æµç¨‹

#### é¢„æµ‹é˜¶æ®µï¼š

##### 1. å°†è¾“å…¥å›¾åƒåˆ’åˆ†ä¸ºç½‘æ ¼

- å°†å›¾åƒç¼©æ”¾åˆ°å›ºå®šå°ºå¯¸ï¼ˆ448x448ï¼‰

- æŠŠè¾“å…¥å›¾åƒåˆ’åˆ†æˆ **S Ã— S çš„ç½‘æ ¼**ï¼ˆæ¯”å¦‚ 7Ã—7ï¼‰ã€‚
- æ¯ä¸ªç½‘æ ¼çš„ä½œç”¨ï¼š
  - å¦‚æœä¸€ä¸ªç‰©ä½“çš„ä¸­å¿ƒè½åœ¨æŸä¸ªç½‘æ ¼ä¸­ï¼Œè¿™ä¸ªç½‘æ ¼å°±è´Ÿè´£æ£€æµ‹è¿™ä¸ªç›®æ ‡ã€‚

![](img/Snipaste_2025-03-07_21-50-41.png)

##### 2.å‰å‘ä¼ æ’­

##### ï¼ˆ1) æ¯ä¸ªç½‘æ ¼é¢„æµ‹å¤šä¸ªè¾¹ç•Œæ¡†

- æ¯ä¸ªç½‘æ ¼ï¼ˆCellï¼‰é¢„æµ‹ B ä¸ªè¾¹ç•Œæ¡†ï¼ˆBounding Boxesï¼‰å’Œå¯¹åº”çš„ç½®ä¿¡åº¦ï¼ˆConfidence Scoreï¼‰ï¼š
  - è¾¹ç•Œæ¡†ä¿¡æ¯ï¼š(x, y, w, h)
    - (x,y)(x, y)(x,y) è¡¨ç¤ºç›®æ ‡ä¸­å¿ƒç›¸å¯¹äºè¯¥ç½‘æ ¼çš„ä½ç½®ï¼ˆå½’ä¸€åŒ–åˆ° 0~1ï¼‰ã€‚
    - (w,h)(w, h)(w,h) æ˜¯ç›®æ ‡ç›¸å¯¹äºæ•´å¼ å›¾åƒçš„å®½é«˜ï¼ˆå½’ä¸€åŒ–åˆ° 0~1ï¼‰ã€‚
  - **ç½®ä¿¡åº¦ï¼ˆConfidenceï¼‰**ï¼šè¡¨ç¤ºè¾¹ç•Œæ¡†å†…æ˜¯å¦æœ‰ç‰©ä½“ã€‚

##### ï¼ˆ2) æ¯ä¸ªç½‘æ ¼åŒæ—¶é¢„æµ‹ç±»åˆ«ï¼ˆClass Predictionï¼‰

- **æ¯ä¸ªç½‘æ ¼è¿˜ä¼šé¢„æµ‹ C ä¸ªç±»åˆ«çš„æ¦‚ç‡**ã€‚
- ä½†æ³¨æ„ï¼Œç±»åˆ«çš„æ¦‚ç‡æ˜¯**æ¡ä»¶æ¦‚ç‡**ï¼Œè¡¨ç¤º**åœ¨è¯¥ç½‘æ ¼æœ‰ç‰©ä½“çš„å‰æä¸‹ï¼Œè¯¥ç‰©ä½“å±äºæŸä¸ªç±»åˆ«çš„æ¦‚ç‡**ã€‚

**æœ€ç»ˆè¾“å‡ºå½¢çŠ¶**ï¼šSÃ—SÃ—(BÃ—(5+C)),å¯¹äºYOLOv1è¾“å‡º7x7x30

![Snipaste_2025-03-08_09-31-31](img/Snipaste_2025-03-08_09-31-31.png)

##### 3.åå¤„ç†

###### (1) è®¡ç®—è¾¹ç•Œæ¡†çš„å®é™…åæ ‡

$$
x_r = (x_p + c_x) * \text{grid\_size}
$$

$$
y_r = (y_p +c_y)*\text{grid\_size}
$$

$$
w_r = w_r*\text{img\_width}
$$

$$
h_r = h_p * \text{img\_height}
$$

###### (2)è®¡ç®—æœ€ç»ˆçš„ç½®ä¿¡åº¦åˆ†æ•°

YOLO è®¡ç®—æ¯ä¸ªè¾¹ç•Œæ¡†çš„ **ç½®ä¿¡åº¦åˆ†æ•°**ï¼ˆConfidence Scoreï¼‰ï¼š
$$
\text{Confidence} = P(\text{Object}) \times \text{IOU}_{\text{pred, truth}}
$$


- **P(Object)**ï¼šç½‘æ ¼æ˜¯å¦åŒ…å«ç›®æ ‡çš„æ¦‚ç‡ã€‚
- **IOUï¼ˆIntersection over Unionï¼‰**ï¼šé¢„æµ‹çš„è¾¹ç•Œæ¡†ä¸çœŸå®ç›®æ ‡çš„é‡å ç¨‹åº¦ã€‚

$$
IOU = \frac{\text{Area}_{\text{intersection}}}{\text{Area}_{\text{union}}}
$$

ç½®ä¿¡åº¦è¿‡ä½çš„æ¡†ä¼šè¢«ä¸¢å¼ƒï¼ˆé€šå¸¸è®¾å®šé˜ˆå€¼ï¼Œæ¯”å¦‚ **0.25**ï¼‰ã€‚

###### **(3) éæå¤§å€¼æŠ‘åˆ¶ï¼ˆNon-Maximum Suppression, NMSï¼‰**

ç”±äº YOLO å¯èƒ½å¯¹åŒä¸€ä¸ªç›®æ ‡é¢„æµ‹å¤šä¸ªè¾¹ç•Œæ¡†ï¼Œéœ€è¦å»é‡ï¼š

1. **æŒ‰ç½®ä¿¡åº¦æ’åº**ï¼šä¼˜å…ˆä¿ç•™ç½®ä¿¡åº¦é«˜çš„æ¡†ã€‚
2. **è®¡ç®— IOUï¼ˆäº¤å¹¶æ¯”ï¼‰**
3. **åˆ é™¤é«˜ IOUï¼ˆ>0.5ï¼‰çš„é‡å¤æ¡†**ï¼Œåªä¿ç•™æœ€ä¼˜çš„ç›®æ ‡æ¡†ã€‚

##### åå¤„ç†å¯è§†åŒ–

![Snipaste_2025-03-08_09-59-44](img/Snipaste_2025-03-08_09-59-44.png)

###### NMSè¯¦è§£

![Snipaste_2025-03-08_10-08-32](img/Snipaste_2025-03-08_10-08-32.png)

![d358fa901b47a00baa710246af0ea197](/Users/kewuyu/è¯¾ç¨‹èµ„æ–™/deeplearn/02-è®ºæ–‡å¤ç°/img/d358fa901b47a00baa710246af0ea197.gif)

#### è®­ç»ƒé˜¶æ®µ

##### ï¼ˆ1ï¼‰**æ•°æ®é¢„å¤„ç†**

- å›¾åƒå½’ä¸€åŒ–
- åˆ’åˆ†ç½‘æ ¼
- ç”Ÿæˆæ ‡ç­¾æ ¼å¼ 

##### ï¼ˆ2ï¼‰**å‰å‘ä¼ æ’­**

- é€šè¿‡ **CNN æå–ç‰¹å¾** å¹¶é¢„æµ‹ç›®æ ‡ä¿¡æ¯ã€‚

##### ï¼ˆ3ï¼‰è®¡ç®—æŸå¤±

- ä½ç½®æŸå¤±ï¼ˆLocalization Lossï¼‰

$$
\lambda_{\text{coord}} \sum_{i=0}^{S^2} \sum_{j=0}^{B} \mathbb{1}_{ij}^{\text{obj}}
\left[ (x_i - \hat{x}_i)^2 + (y_i - \hat{y}_i)^2 \right]
$$



- å°ºåº¦æŸå¤±ï¼ˆScale Lossï¼‰

$$
\lambda_{\text{coord}} \sum_{i=0}^{S^2} \sum_{j=0}^{B} \mathbb{1}_{ij}^{\text{obj}}
\left[ (\sqrt{w_i} - \sqrt{\hat{w}_i})^2 + (\sqrt{h_i} - \sqrt{\hat{h}_i})^2 \right]
$$

- ç›®æ ‡ç½®ä¿¡åº¦æŸå¤±ï¼ˆConfidence Loss for Objectsï¼‰

$$
\sum_{i=0}^{S^2} \sum_{j=0}^{B} \mathbb{1}_{ij}^{\text{obj}} (C_i - \hat{C}_i)^2
$$

- èƒŒæ™¯ç½®ä¿¡åº¦æŸå¤±ï¼ˆConfidence Loss for No Objectï¼‰

$$
\lambda_{\text{noobj}} \sum_{i=0}^{S^2} \sum_{j=0}^{B} \mathbb{1}_{ij}^{\text{noobj}} (C_i - \hat{C}_i)^2
$$

- åˆ†ç±»æŸå¤±ï¼ˆClassification Lossï¼‰

$$
\sum_{i=0}^{S^2} \mathbb{1}_{i}^{\text{obj}} \sum_{c \in \text{classes}} (p_i(c) - \hat{p}_i(c))^2
$$

- æœ€ç»ˆæŸå¤±å‡½æ•°ï¼ˆYOLO Lossï¼‰

$$
\mathcal{L} = \lambda_{\text{coord}} \sum_{i=0}^{S^2} \sum_{j=0}^{B} \mathbb{1}_{ij}^{\text{obj}}
\left[ (x_i - \hat{x}_i)^2 + (y_i - \hat{y}_i)^2 \right]
+ \lambda_{\text{coord}} \sum_{i=0}^{S^2} \sum_{j=0}^{B} \mathbb{1}_{ij}^{\text{obj}}
\left[ (\sqrt{w_i} - \sqrt{\hat{w}_i})^2 + (\sqrt{h_i} - \sqrt{\hat{h}_i})^2 \right]
+ \sum_{i=0}^{S^2} \sum_{j=0}^{B} \mathbb{1}_{ij}^{\text{obj}} (C_i - \hat{C}_i)^2
+ \lambda_{\text{noobj}} \sum_{i=0}^{S^2} \sum_{j=0}^{B} \mathbb{1}_{ij}^{\text{noobj}} (C_i - \hat{C}_i)^2
+ \sum_{i=0}^{S^2} \mathbb{1}_{i}^{\text{obj}} \sum_{c \in \text{classes}} (p_i(c) - \hat{p}_i(c))^2
$$

